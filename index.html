<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Attic Solution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .hero-bg {
            background-color: #1a202c;
            background-image: radial-gradient(circle at 1px 1px, #374151 1px, transparent 0);
            background-size: 20px 20px;
        }

        .modal {
            transition: opacity 0.2s ease, transform 0.3s ease;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="min-h-screen flex flex-col items-center justify-center hero-bg text-white p-4">
        <div class="text-center max-w-2xl">
            <div class="flex items-center justify-center mb-6"><svg class="h-12 w-12 mr-3 text-blue-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.546-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h1 class="text-5xl font-rabold">Attic Solution</h1>
            </div>
            <p class="text-lg text-gray-300 mb-10">Your personalized gateway to learning. Choose your role to begin.</p>
        </div>
        <div class="bg-white/10 backdrop-blur-sm p-8 rounded-2xl shadow-lg border border-gray-700">
            <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-6">
                <a href="#" id="student-login-btn"
                    class="group flex-1 flex flex-col items-center p-8 bg-gray-800 rounded-xl hover:bg-blue-600 transition-all duration-300 transform hover:-translate-y-2">
                    <div class="mb-4"><svg class="h-16 w-16 text-blue-400 group-hover:text-white transition-colors"
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M4.26 10.147a60.438 60.438 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.906 59.906 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0l-2.072-1.036A48.423 48.423 0 0012 3.493a48.423 48.423 0 0011.75 5.617l-2.072 1.036m-17.404 0A50.57 50.57 0 0012 13.489a50.57 50.57 0 007.72-3.342M3.75 12h16.5" />
                        </svg></div>
                    <h2 class="text-2xl font-bold text-white mb-2">Login as Student</h2>
                    <p class="text-gray-400 group-hover:text-blue-100 transition-colors text-center">Use your registered
                        email to access your dashboard.</p>
                </a>
                <a href="#" id="teacher-login-btn"
                    class="group flex-1 flex flex-col items-center p-8 bg-gray-800 rounded-xl hover:bg-purple-600 transition-all duration-300 transform hover:-translate-y-2">
                    <div class="mb-4"><svg class="h-16 w-16 text-purple-400 group-hover:text-white transition-colors"
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                        </svg></div>
                    <h2 class="text-2xl font-bold text-white mb-2">Login as Teacher</h2>
                    <p class="text-gray-400 group-hover:text-purple-100 transition-colors text-center">Use your
                        registered email to access your dashboard.</p>
                </a>
            </div>
        </div>
    </div>

    <!-- Universal Login Modal -->
    <div id="login-modal"
        class="modal fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50 opacity-0">
        <div class="bg-gray-800 rounded-2xl shadow-lg p-8 w-full max-w-md transform transition-transform scale-95">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modal-title" class="text-2xl font-bold text-white">Login</h2><button id="close-modal-btn"
                    class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            <form id="login-form">
                <input type="hidden" id="login-role" name="role">
                <div class="mb-4"><label for="login-email" class="block text-gray-300 text-sm font-bold mb-2">Institute
                        Email Address</label><input type="email" id="login-email" name="email" required
                        class="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 border-gray-600 text-white leading-tight focus:outline-none focus:shadow-outline focus:border-blue-500"
                        placeholder="e.g., alice@example.com"></div>
                <div class="flex items-center justify-end"><button type="submit" id="modal-submit-btn"
                        class="text-white font-bold py-2 px-4 rounded-lg focus:outline-none focus:shadow-outline transition-colors">Login
                        to Dashboard</button></div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_BASE_URL = 'http://localhost:3000';

            const studentLoginBtn = document.getElementById('student-login-btn');
            const teacherLoginBtn = document.getElementById('teacher-login-btn');
            const loginModal = document.getElementById('login-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const loginForm = document.getElementById('login-form');
            const modalTitle = document.getElementById('modal-title');
            const loginRole = document.getElementById('login-role');
            const modalSubmitBtn = document.getElementById('modal-submit-btn');

            const openModal = (role) => {
                loginRole.value = role;
                if (role === 'student') {
                    modalTitle.textContent = 'Student Login';
                    modalSubmitBtn.className = 'bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg';
                } else {
                    modalTitle.textContent = 'Teacher Login';
                    modalSubmitBtn.className = 'bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg';
                }
                loginModal.classList.remove('hidden');
                setTimeout(() => {
                    loginModal.classList.remove('opacity-0');
                    loginModal.querySelector('div').classList.remove('scale-95');
                }, 10);
            };

            const closeModal = () => {
                loginModal.classList.add('opacity-0');
                loginModal.querySelector('div').classList.add('scale-95');
                setTimeout(() => {
                    loginModal.classList.add('hidden');
                    loginForm.reset();
                }, 300);
            };

            studentLoginBtn.addEventListener('click', (e) => { e.preventDefault(); openModal('student'); });
            teacherLoginBtn.addEventListener('click', (e) => { e.preventDefault(); openModal('teacher'); });
            closeModalBtn.addEventListener('click', closeModal);
            loginModal.addEventListener('click', (e) => { if (e.target === loginModal) closeModal(); });

            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const role = document.getElementById('login-role').value;

                try {
                    const response = await fetch(`${API_BASE_URL}/api/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, role })
                    });

                    if (!response.ok) {
                        throw new Error('User not found. Please check your email.');
                    }

                    const user = await response.json();

                    // Store complete user data
                    localStorage.setItem('currentUser', JSON.stringify(user));
                    localStorage.setItem('currentUserId', user.id);
                    localStorage.setItem('currentUserRole', role);

                    // Redirect to appropriate dashboard
                    if (role === 'student') {
                        window.location.href = './dashboard-new.html';
                    } else if (role === 'teacher') {
                        window.location.href = './teacher-dashboard.html';
                    }

                } catch (error) {
                    console.error('Login failed:', error);
                    alert(error.message);
                }
            });
        });
    </script>
</body>

</html>